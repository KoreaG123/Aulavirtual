<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bienvenido | Aula Virtual</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <!-- ====== NAVBAR ====== -->
  <header class="navbar">
    <h1>Aula Virtual</h1>
    <button id="logoutBtn">Cerrar sesión</button>
  </header>

  <!-- ====== MAIN CONTENT ====== -->
  <main class="container">
    <!-- Bienvenida -->
    <section class="welcome-section">
      <h2>¡Bienvenido a tu aula virtual!</h2>
      <p>Estás usando una cuenta <strong>invitado</strong>. Explora los videos básicos y aprende a tu ritmo.</p>
    </section>

    <!-- Videos básicos -->
    <section class="videos-section">
      <h3>Videos básicos</h3>
      <div class="video-cards">
        <div class="card">
          <h4>Introducción</h4>
          <video controls src="videos/intro.mp4"></video>
        </div>
        <div class="card">
          <h4>Primeros pasos</h4>
          <video controls src="videos/primeros_pasos.mp4"></video>
        </div>
        <!-- Agrega más cards según necesites -->
      </div>
    </section>

    <!-- Solicitud de acceso -->
    <section class="request-section">
      <button id="requestAccessBtn" class="primary-btn">Cómo volverte alumno</button>
      <p id="statusMsg"></p>
    </section>
  </main>

  <!-- ====== FOOTER ====== -->
  <footer>
    <p>© 2026 Aula Virtual. Todos los derechos reservados.</p>
  </footer>

  <!-- ====== FIREBASE ====== -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script src="js/firebase.js"></script>
  <script src="js/welcome.js"></script>

  <!-- ====== SCRIPT LOCAL ====== -->
  <script>
    const logoutBtn = document.getElementById("logoutBtn");
    const requestBtn = document.getElementById("requestAccessBtn");
    const statusMsg = document.getElementById("statusMsg");

    // Botón cerrar sesión
    logoutBtn.onclick = async () => {
      await firebase.auth().signOut();
      location.href = "index.html";
    };

    // Botón solicitar acceso
    requestBtn.onclick = () => requestAccess();

    // ====== CONTROL DE GUEST ======
    firebase.auth().onAuthStateChanged(async user => {
      if (!user) return location.href = "index.html";

      const userDoc = await firebase.firestore().collection("users").doc(user.uid).get();

      if (!userDoc.exists) {
        alert("Usuario no registrado");
        await firebase.auth().signOut();
        return location.href = "index.html";
      }

      const role = userDoc.data().role;

      // Si ya es alumno o admin, redirigir
      if (role === "alumno") location.href = "dashboard.html";
      else if (role === "admin") location.href = "admin.html";
      else if (role === "profesor") location.href = "profesor.html"; // si tienes ese rol

      // Revisar si ya envió solicitud
      const req = await firebase.firestore().collection("requests").doc(user.uid).get();
      if (req.exists) {
        requestBtn.disabled = true;
        statusMsg.textContent = "⏳ Solicitud enviada. Esperando aprobación.";
      }
    });
  </script>
</body>
</html>
